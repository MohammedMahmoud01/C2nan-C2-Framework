var ExploitationsData = {

    exploitations:[],

    GetExploitations: function(){
        $.ajax({
            url: `/tasksApi/5/`,
            type: "GET",
            success: function (data) {
                ExploitationsData.exploitations = data;
                ExploitationsDraw.DrawSelect();
            },
            error: function () {
                //alert("Error");
            }
        })

    },


    StartExploit : function(id){

         if (id == '91') {

            var path_to_execute = $("#path_to_execute").val();

            if (path_to_execute == '' || path_to_execute == undefined || path_to_execute == null) {
                $("#path_to_executeValidation").css("display", "block");
                return;
            }
            else $("#path_to_executeValidation").css("display", "none");

            var model = {
                agent: agentName,
                agentId: agentId,
                moduleId:id,
                path_to_execute:path_to_execute
            }

            HelperV2.AjaxCallPost(`/Auto_SeDebugPrivilege/`, model, function (data) {
                SwalFireMessage.SuccessMessage();
            });
          
        }
    }
}

var ExploitationsDraw = {

    DrawSelect: function(){
        var listItems = '<option selected="selected" disabled>choose Task</option>';


        $.each(ExploitationsData.exploitations, function (key, value) {
            listItems += ` <option data-type='${value.module_type}' value='${value.id}'>${value.module_name}</option> `;
        });
        // debugger;
        $("#selectExploitations").append(listItems);
        //Initialize Select2 Elements

        $('.select2bs4').select2({
            theme: 'bootstrap4'
        })

    },

    DrawExploit: function(event){
        var id = event.target.value;
        debugger;
      if (id == '91') {
            var html = `  <div class="col-8">

                                <div class="form-group">
                                    <label for="Path">SeDebugPrivilege Auto Exploitaion</label>
                                    <input type="text" class="form-control" style="width:100%" value="C:\\Windows\\System32\\cmd.exe" maxlength="100" id="path_to_execute">
                                    <span type="text" class="text-danger font-weight-bold" id="path_to_executeValidation"
                                    style="display: none;">Please Enter path_to_execute</span>
                                </div>

                                <div class="col-3">
                                     <button class="btn btn-info" onclick="ExploitationsData.StartExploit('${id}')">Start</button>
                                </div>
                            </div>`

                    $("#ExploitaionsTask").html(html);
        }

    }

}


$(document).ready(function () {
    // debugger;
    ExploitationsData.GetExploitations();
});
